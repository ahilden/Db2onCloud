<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <meta name="DC.Publisher" content="IBM Corporation">
  <meta name="DC.rights" content="&#xA9; Copyright IBM Corporation 2014, 2019">
  <meta name="IBM.Country" content="ZZ">
  <meta name="DC.date" content="2019-01-21">
  <meta name="dcterms.date" content="2019-01-21">
  <meta name="keywords" content="{{ keywords }}">
  <meta name="subcollection" content="Db2onCloud">
  <meta name="description" content="Identity and access management (IAM) enables you to securely authenticate users for platform services and control access to resources consistently across the IBM Cloud platform. For example, with only a single login to IBM Cloud with your IBMid, you have access to any of your service consoles and their applications without having to log in to each of them separately.">
  <meta name="source.format" content="markdown">

  <meta name="github.edit" content="yes" repo="https://github.com/IBM-Bluemix-Docs/Db2onCloud/blob/master/iam.md">
  <meta name="github.issue" content="yes" repo="https://github.com/IBM-Bluemix-Docs/Db2onCloud/issues/new">

  <!-- Licensed Materials - Property of IBM -->
  <!-- US Government Users Restricted Rights -->
  <!-- Use, duplication or disclosure restricted by -->
  <!-- GSA ADP Schedule Contract with IBM Corp. -->

  <title>Identity and access management (IAM) on IBM Cloud</title>
</head>

<body>
  <main role="main">
    <article aria-labelledby="iam" role="article">
      <!-- Attribute definitions -->
      <section id="section-iam">
        <h1 id="iam">Identity and access management (IAM) on IBM Cloud</h1>
        <p class="shortdesc">Identity and access management (IAM) enables you to securely authenticate users for platform services and control access to resources consistently across the IBM Cloud platform. For example, with only a single login to IBM Cloud with your IBMid,
          you have access to any of your service consoles and their applications without having to log in to each of them separately.</p>
        <section id="section-enabled">
          <h2 id="enabled">Is IAM enabled on your instance?</h2>
          <p>Over a period of time, the IBM&reg; Db2&reg; on Cloud managed database instances on IBM Cloud will be enabled to use IAM for access control. To check that IAM is enabled on your instance, run the following query:</p>
          <p><code>SELECT CASE WHEN VALUE = &#39;IBMIAMauth&#39; THEN 1 ELSE 0 END AS IAM_ENABLED FROM SYSIBMADM.DBMCFG WHERE NAME = &#39;srvcon_gssplugin_list&#39;</code></p>
          <p>If the returned value of <strong>IAM_ENABLED</strong> is 1, then IAM is enabled on your instance.</p>
        </section>
        <section id="section-features">
          <h2 id="features">Features of IBM Cloud IAM</h2>
          <p>The following IAM features are implemented for the Db2 on Cloud managed service with two types of supported identities:</p>
          <p><strong>IBMid</strong></p>
          <p>Users with an IBMid must be added to each database service instance by the database administrator through the console or REST API before these users can connect to the particular database service instance. Just like for a non-IBMid user, a user
            ID for the database service instance must be entered at the same time that the IBMid user is added. This user ID needs to be unique within the database service instance. This user ID is also the authorization (AUTH) ID within the database.
            The database administrator can grant and revoke permissions based on the AUTH ID.</p>
          <p><strong>Service IDs</strong></p>
          <p>A service ID identifies a service or application similar to how a user ID identifies a user. The service IDs are IDs that can be used by applications to authenticate with an IBM Cloud service. A service ID represents a separate entity from the
            owning IBMid. Therefore, different authorities and permissions can be granted specific to the service ID within the database. Service IDs do not have passwords. An API key must be created for each service ID for the service ID to connect to
            the database service instance. For more information about service IDs, see: <a href="https://www.ibm.com/blogs/bluemix/2017/10/introducing-ibm-cloud-iam-service-ids-api-keys/" target="_blank" class="external">Introducing IBM Cloud IAM Service IDs and API Keys</a>.</p>
        </section>
        <section id="section-connect_user">
          <h2 id="connect_user">Client connections and user logins</h2>
          <p><strong>Prerequisite</strong>: Db2 Client V11.1 FP3 and later.</p>
          <p>The following methods can be used for IAM authentication:</p>
          <p><strong>Access token</strong></p>
          <p>An access token can be obtained from the IAM service directly by the application through the REST API by using an API key. For more information, see: <a href="/docs/iam?topic=iam-iamtoken_from_apikey#iamtoken_from_apikey" target="_blank" class="external">Getting an IBM Cloud IAM token by using an API key</a>.
            The access token has a default validity period of 60 minutes before it expires. If the token has expired, the Db2 server won&#39;t allow the connection to be established. The token isn’t checked for expiry after the connection is established.
            Just as it was prior to IAM integration, the connection will stay connected until the application disconnects or the connection is terminated due to other reasons.</p>
          <pre><code class="hljs">curl -k -X POST \
  --header &quot;Content-Type: application/x-www-form-urlencoded&quot; \
  --header &quot;Accept: application/json&quot; \
  --data-urlencode &quot;grant_type=urn:ibm:params:oauth:grant-type:apikey&quot; \
  --data-urlencode &quot;apikey=&lt;apikey&gt;&quot; \
  &quot;https://iam.bluemix.net/identity/token&quot;
</code></pre>
          <p>An access token identifies an IBMid user or a service ID to the database. The database server verifies the validity of the access token before accepting it. This is the best method if the application needs to connect to more than one database
            service instance or other IBM Cloud service instances because it minimizes the communication to the IAM service to validate the access token.</p>
          <p><strong>API key</strong></p>
          <p>Multiple API keys can be created for each IBMid user or service ID. Each API key is typically created for a single application. It allows the application to connect to the database service instance as long as the owning IBMid or service ID is
            added as a user to the same database service instance. The API key has the same authorities and permissions within the database as the owning IBMid or service ID. If an application should no longer be allowed to connect to the database, the
            corresponding API key can be removed. This method of authentication requires less changes in the application than using an access token as it requires no direct interaction with the IAM service. For more information about creating and managing
            API keys, see: <a href="/docs/iam?topic=iam-userapikey#userapikey" target="_blank" class="external">Managing user API keys</a>.</p>
          <p><strong>IBMid/password</strong></p>
          <p>The IBMid/password can be used to log in to the console and can also be used within the application in the same ways that a user ID/password is allowed. The exception occurs when the IBMid is federated because a redirection to your organization’s
            login page cannot be done. However, the recommended method for an application to establish a connection to the database service instance is to use an access token.</p>
        </section>
        <section id="section-sup-if">
          <h2 id="sup-if">Supported interfaces</h2>
          <p>The following database client interfaces are supported:</p>
          <ul>
            <li><a href="#odbc-clpplus">ODBC</a></li>
            <li><a href="#odbc-clpplus">CLP</a></li>
            <li><a href="#odbc-clpplus">CLPPLUS</a></li>
            <li><a href="#jdbc">JDBC</a></li>
          </ul>
          <section id="section-odbc-clpplus">
            <h3 id="odbc-clpplus">ODBC, CLP, and CLPPLUS</h3>
            <p>For an ODBC application or a command line client (CLP, CLPPLUS) to connect to a Db2 server using IAM authentication, a data source name (DSN) needs to be configured first in a <code>db2dsdriver.cfg</code> configuration file by running the
              following command:</p>
            <p><code>db2cli writecfg add -dsn &lt;dsn_alias&gt; -database &lt;database_name&gt; -host &lt;host_name_or_IP_address&gt; -port 50001 -parameter &quot;Authentication=GSSPLUGIN;SecurityTransportMode=SSL&quot;</code></p>
            <p>The <code>db2dsdriver.cfg</code> configuration file is an XML file, typically located in the <code>sqllib/cfg</code> directory, that contains a list of DSN aliases and their properties.</p>
            <p>The following example of a <code>db2dsdriver.cfg</code> configuration file shows the configurations that are used to establish a connection to a database service instance. The configuration file provides the DSN alias, the database name, the
              host name (or IP address), and the <strong>Authentication</strong> type and <strong>SecurityTransportMode</strong> parameter values:</p>
            <pre><code class="hljs">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&gt;
&lt;configuration&gt;
        &lt;dsncollection&gt;
        &lt;dsn alias=&quot;&lt;data_source_name&gt;&quot; name=&quot;bludb&quot; host=&quot;&lt;host_name_or_IP_address&gt;&quot; port=&quot;50001&quot;&gt;
            &lt;parameter name=&quot;Authentication&quot; value=&quot;GSSPLUGIN&quot;/&gt;
            &lt;parameter name=&quot;SecurityTransportMode&quot; value=&quot;SSL&quot;/&gt;
        &lt;/dsn&gt;
        &lt;/dsncollection&gt;
        &lt;databases&gt;
            &lt;database name=&quot;bludb&quot; host=&quot;&lt;host_name_or_IP_address&gt;&quot; port=&quot;50001&quot;/&gt;
        &lt;/databases&gt;
&lt;/configuration&gt;
</code></pre>
            <ul>
              <li>
                <p>The ODBC connection string can contain one of the following:</p>
                <p> <strong>Access token</strong></p>
                <p> <code>DSN=&lt;dsn&gt;;ACCESSTOKEN=&lt;access_token&gt;</code></p>
                <p> <strong>API key</strong></p>
                <p> <code>DSN=&lt;dsn&gt;;APIKEY=&lt;api_key&gt;</code></p>
                <p> <strong>IBMid/password</strong></p>
                <p> <code>DSN=&lt;dsn&gt;;UID=&lt;ibmid&gt;;PWD=&lt;password&gt;</code></p>
                <p> For ODBC, the <strong>AUTHENTICATION=GSSPLUGIN</strong> can be specified in either the <code>db2dsdriver.cfg</code> configuration file or in the application’s connection string.</p>
              </li>
              <li>
                <p>The CLP CONNECT statement can contain one of the following:</p>
                <p> <strong>Access token</strong></p>
                <p> Connect to the database server <code>&lt;database_server_name&gt;</code> and pass the access token by running the following command at the CLP command prompt or script:</p>
                <p> <code>CONNECT TO &lt;database_server_name&gt; ACCESSTOKEN &lt;access_token_string&gt;</code></p>
                <p> <strong>API key</strong></p>
                <p> Connect to the database server <code>&lt;database_server_name&gt;</code> with an API key by running the following command at the CLP command prompt or script:</p>
                <p> <code>CONNECT TO &lt;database_server_name&gt; APIKEY &lt;api-key-string&gt;</code></p>
                <p> <strong>IBMid/password</strong></p>
                <p> Connect to the database server <code>&lt;database_server_name&gt;</code> with an IBMid/password by running the following command at the CLP command prompt or script:</p>
                <p> <code>CONNECT TO &lt;database_server_name&gt; USER &lt;IBMid&gt; USING &lt;password&gt;</code></p>
                <p> For more details about connecting to a database server with CLP, see: <a href="https://www.ibm.com/support/knowledgecenter/SS6NHC/com.ibm.swg.im.dashdb.sql.ref.doc/doc/r0000908.html" target="_blank" class="external">CONNECT (type 2) statement</a>.
                  </p>
              </li>
              <li>
                <p>The CLPPLUS CONNECT statement can contain one of the following:</p>
                <p> <strong>Access token</strong></p>
                <p> Connect to the DSN alias (<code>@&lt;data_source_name&gt;</code>) and pass the access token by running the following command at the CLPPLUS command prompt or script:</p>
                <p> <code>connect @&lt;data_source_name&gt; using(accesstoken &lt;access_token_string&gt;)</code></p>
                <p> <strong>API key</strong></p>
                <p> Connect to the DSN alias (<code>@&lt;data_source_name&gt;</code>) with an API key by running the following command at the CLPPLUS command prompt or script:</p>
                <p> <code>connect @&lt;data_source_name&gt; using(apikey &lt;api-key-string&gt;)</code></p>
                <p> <strong>IBMid/password</strong></p>
                <p> Connect to the DSN alias (<code>@&lt;data_source_name&gt;</code>) with an IBMid/password by running the following command at the CLPPLUS command prompt or script:</p>
                <p> <code>connect &lt;IBMid&gt;/&lt;password&gt;@&lt;data_source_name&gt;</code></p>
                <p> For more details about connecting to DSN aliases with CLPPLUS, see: <a href="https://www.ibm.com/support/knowledgecenter/SS6NHC/com.ibm.swg.im.dashdb.clpplus.doc/doc/c0057148.html" target="_blank" class="external">DSN aliases in CLPPlus</a>.</p>
              </li>
            </ul>
          </section>
          <section id="section-jdbc">
            <h3 id="jdbc">JDBC</h3>
            <p>Type 4 JDBC Driver is supported for IAM authentication.</p>
            <p>The following examples show connection snippets for the three methods:</p>
            <p><strong>Access token</strong></p>
            <pre><code class="hljs">DB2SimpleDataSource dataSource;

dataSource.setDriverType( 4 );
dataSource.setDatabaseName( &quot;BLUDB&quot; );
dataSource.setServerName( &quot;&lt;host_name_or_IP_address&gt;&quot; );
dataSource.setPortNumber( 50001 );
dataSource.setSecurityMechanism( com.ibm.db2.jcc.DB2BaseDataSource.PLUGIN_SECURITY );
dataSource.setPluginName( &quot;IBMIAMauth&quot; );
dataSource.setAccessToken( &quot;&lt;access_token&gt;&quot; );
Connection conn = dataSource.getConnection( );
</code></pre>
            <p>or</p>
            <pre><code class="hljs">Connection conn = DriverManager.getConnection( &quot;jdbc:db2://&lt;host_name_or_IP_address&gt;:50001/BLUDB:accessToken=&lt;access_token&gt;;securityMechanism=15;pluginName=IBMIAMauth;sslConnection=true&quot; );
</code></pre>
            <p><strong>API key</strong></p>
            <pre><code class="hljs">DB2SimpleDataSource dataSource;

dataSource.setDriverType( 4 );
dataSource.setDatabaseName( &quot;BLUDB&quot; );
dataSource.setServerName( &quot;&lt;host_name_or_IP_address&gt;&quot; );
dataSource.setPortNumber( 50001 );
dataSource.setSecurityMechanism( com.ibm.db2.jcc.DB2BaseDataSource.PLUGIN_SECURITY );
dataSource.setPluginName( &quot;IBMIAMauth&quot; );
dataSource.setApiKey( &quot;&lt;api_key&gt;&quot; );
Connection conn = dataSource.getConnection( );
</code></pre>
            <p>or</p>
            <pre><code class="hljs">Connection conn = DriverManager.getConnection( &quot;jdbc:db2://&lt;host_name_or_IP_address&gt;:50001/BLUDB:apiKey=&lt;api_key&gt;;securityMechanism=15;pluginName=IBMIAMauth;sslConnection=true&quot; );
</code></pre>
            <p><strong>IBMid/password</strong></p>
            <pre><code class="hljs">DB2SimpleDataSource dataSource;

dataSource.setDriverType( 4 );
dataSource.setDatabaseName( &quot;BLUDB&quot; );
dataSource.setServerName( &quot;&lt;host_name_or_IP_address&gt;&quot; );
dataSource.setPortNumber( 50001 );
dataSource.setSecurityMechanism( com.ibm.db2.jcc.DB2BaseDataSource.PLUGIN_SECURITY );
dataSource.setPluginName( &quot;IBMIAMauth&quot; );
Connection conn = dataSource.getConnection( &quot;&lt;IBMid&gt;&quot;, &quot;&lt;password&gt;&quot; );
</code></pre>
            <p>or</p>
            <pre><code class="hljs">Connection conn = DriverManager.getConnection( &quot;jdbc:db2://&lt;host_name_or_IP_address&gt;:50001/BLUDB:user=&lt;IBMid&gt;;password=&lt;password&gt;;securityMechanism=15;pluginName=IBMIAMauth;sslConnection=true&quot; );
</code></pre>
          </section>
        </section>
        <section id="section-console-ux">
          <h2 id="console-ux">Console user experience</h2>
          <p>The service console login page has the option to log in with your IBMid and password. After the <strong>Sign In via IBMid</strong> button is clicked, the user is directed to the IAM login page, on which the password is entered. When authentication
            is completed, the user is redirected back to the console. Before such login can be successful, the IBMid user must be added to each database service instance by the database administrator through the console or REST API. Just like for a non-IBMid
            user, a user ID for the database service instance must be entered at the same time that the IBMid user is added. The user ID needs to be unique within the database service instance. This user ID is also the authorization (AUTH) ID within the
            database.</p>
        </section>
        <section id="section-api">
          <h2 id="api">REST API experience</h2>
          <p>The Db2 on Cloud REST API was enhanced to also accept an IAM access token for the functions that previously accepted a database service-generated access token.</p>
          <ul>
            <li>
              <p>To add a new IBMid user, run the following example API call:</p>
              <p><code>curl --tlsv1.2 &quot;https://&lt;IPaddress&gt;/dbapi/v3/users&quot; -H &quot;Authorization: Bearer &lt;access_token&gt;&quot; -H &quot;accept: application/json&quot; -H &quot;Content-Type: application/json&quot; -d &quot;{&quot;id&quot;:&quot;&lt;userid&gt;&quot;,&quot;ibmid&quot;:&quot;&lt;userid&gt;@&lt;email_address_domain&gt;&quot;,&quot;role&quot;:&quot;bluadmin&quot;,&quot;locked&quot;:&quot;no&quot;,&quot;iam&quot;:true}&quot;</code></p>
              <p class="note">The <code>&lt;userid&gt;</code> value for <code>&quot;id&quot;</code> and <code>&quot;ibmid&quot;</code> do not have to be the same. The two different IDs are not linked together in any way.</p>
            </li>
            <li>
              <p>To migrate an existing non-IBMid database user (for example, <code>abcuser</code>) and make them an IBMid user, first delete the non-IBMid user ID by running the following example API call:</p>
              <p><code>curl --tlsv1.2 -X DELETE &quot;https://&lt;IPaddress&gt;/dbapi/v3/users/abcuser&quot; -H &quot;Authorization: Bearer &lt;access_token&gt;&quot; -H &quot;accept: application/json&quot; -H &quot;Content-Type: application/json&quot;</code></p>
              <p>Next, re-add the user with an IBMid that is the same as the previous user ID (<code>abcuser</code>) by running the following example API call:</p>
              <p><code>curl --tlsv1.2 &quot;https://&lt;IPaddress&gt;/dbapi/v3/users&quot; -H &quot;Authorization: Bearer &lt;access_token&gt;&quot; -H &quot;accept: application/json&quot; -H &quot;Content-Type: application/json&quot; -d &quot;{&quot;id&quot;:&quot;abcuser&quot;,&quot;ibmid&quot;:&quot;abcuser@&lt;email_address_domain&gt;&quot;,&quot;role&quot;:&quot;bluadmin&quot;,&quot;locked&quot;:&quot;no&quot;,&quot;iam&quot;:true}&quot;</code></p>
              <p>Because the user ID (<code>abcuser</code>) remains the same for the new IBMid for that user, the granted database permissions for the user remain unchanged. If a list of existing non-IBMid database users needs to be migrated to make them
                IBMid users, you are required to run the previous pair of API calls for each user.</p>
            </li>
            <li>
              <p>To add many new IBMid users at one time, create a batch file that lists the following example API calls, one for each user:</p>
              <pre><code class="hljs">curl --tlsv1.2 &quot;https://&lt;IPaddress&gt;/dbapi/v3/users&quot; -H &quot;Authorization: Bearer &lt;access_token&gt;&quot; -H &quot;accept: application/json&quot; -H &quot;Content-Type: application/json&quot; -d &quot;{&quot;id&quot;:&quot;&lt;userid1&gt;&quot;,&quot;ibmid&quot;:&quot;&lt;userid1&gt;@&lt;email_address_domain&gt;&quot;,&quot;role&quot;:&quot;bluadmin&quot;,&quot;locked&quot;:&quot;no&quot;,&quot;iam&quot;:true}&quot;
curl --tlsv1.2 &quot;https://&lt;IPaddress&gt;/dbapi/v3/users&quot; -H &quot;Authorization: Bearer &lt;access_token&gt;&quot; -H &quot;accept: application/json&quot; -H &quot;Content-Type: application/json&quot; -d &quot;{&quot;id&quot;:&quot;&lt;userid2&gt;&quot;,&quot;ibmid&quot;:&quot;&lt;userid2&gt;@&lt;email_address_domain&gt;&quot;,&quot;role&quot;:&quot;bluadmin&quot;,&quot;locked&quot;:&quot;no&quot;,&quot;iam&quot;:true}&quot;
.
.
.
</code></pre>
            </li>
          </ul>
          <p>For more details about your service&#39;s API, see: <a href="https://cloud.ibm.com/apidocs/db2-on-cloud" target="_blank" class="external">Db2 on Cloud REST API</a>.</p>
        </section>
        <section id="section-fed_ibmid">
          <h2 id="fed_ibmid">IBMid federation</h2>
          <p>To use your own identity provider such as LDAP, you must first federate your LDAP server with IBMid. For instructions about federating your LDAP server with IBMid, see: <a href="https://ibm.ent.box.com/notes/78040808400?v=IBMid-Federation-Guide"
              target="_blank" class="external">IBMid Enterprise Federation Adoption Guide</a>. After IBMid federation is completed and the allowed users are added to the database service instance by the database administrator, these users can log in to
            the console with their company user ID and password. Alternatively, these users can use an access token or API key that represents their user ID to connect to the database service instance through one of the supported database client interfaces.</p>
        </section>
        <section id="section-restrictions">
          <h2 id="restrictions">Restrictions</h2>
          <p>The following are restrictions with regard to IAM authentication:</p>
          <ul>
            <li>IAM authentication for a Db2 client that is connecting to a Db2 server is only supported over an SSL connection.</li>
            <li>IBMid federation is supported to allow custom user management portal or server to be used for authentication. Such support does not include any group federation.</li>
            <li>IAM authentication for database federation is not supported.</li>
            <li>Running IDA and user-defined extension (UDX) commands through CLPPlus are not supported.</li>
            <li>Type 2 JDBC Driver is not supported.</li>
          </ul>
        </section>
      </section>
    </article>
  </main>
</body>
</html>